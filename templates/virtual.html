{% extends "base.html" %}
{% block title %}Virtual Try-On - Uniglow{% endblock %}

{% block content %}
        <div class="px-40 flex flex-1 justify-center py-5">
          <div class="layout-content-container flex flex-col max-w-[960px] flex-1">
            <h2 class="text-[#141414] text-[22px] font-bold leading-tight tracking-[-0.015em] px-4 pb-3 pt-5">Selected Items</h2>
            {% if images %}
              {% for item in images %}
              <div class="p-4 product-image-container">
                <div class="flex items-stretch justify-between gap-4 rounded-lg">
                  <div class="flex flex-[2_2_0px] flex-col gap-4">
                    <div class="flex flex-col gap-1">
                      {% if item is mapping %}
                      <p class="text-[#141414] text-base font-bold leading-tight">{{ item.title }}</p>
                      {% else %}
                      <p class="text-[#141414] text-base font-bold leading-tight">Product from Catalog</p>
                      {% endif %}
                      <p class="text-neutral-500 text-sm font-normal leading-normal">Size: M</p>
                    </div>
                    <a href="{{ url_for('remove_from_virtual_try_on', image_url=item.image_url if item is mapping else item) }}"
                      class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-8 px-4 flex-row-reverse bg-[#ededed] text-[#141414] text-sm font-medium leading-normal w-fit"
                    >
                      <span class="truncate">Remove</span>
                    </a>
                  </div>
                  <div
                    class="w-full bg-center bg-no-repeat aspect-square bg-cover rounded-lg flex-1"
                    style='background-image: url("{{ item.image_url if item is mapping else item }}");'
                  ></div>
                </div>
              </div>
              {% endfor %}
            {% else %}
              <div class="p-4">
                <p class="text-center">You have no items selected for virtual try-on. Please <a href="{{ url_for('products') }}" class="text-blue-500">select some products</a> to get started.</p>
              </div>
            {% endif %}
            <div class="flex flex-wrap justify-between gap-3 p-4"><p class="text-[#141414] tracking-light text-[32px] font-bold leading-tight min-w-72">Virtual Try-On</p></div>
            <p class="text-[#141414] text-base font-normal leading-normal pb-3 pt-1 px-4">Upload a photo or use a model to see how this item looks on you.</p>
            <div class="pb-3">
              <div class="flex border-b border-[#dbdbdb] px-4 gap-8">
                <a id="upload-tab" class="flex flex-col items-center justify-center border-b-[3px] border-b-[#141414] text-[#141414] pb-[13px] pt-4" href="#">
                  <p class="text-[#141414] text-sm font-bold leading-normal tracking-[0.015em]">Upload Photo</p>
                </a>
                <a id="model-tab" class="flex flex-col items-center justify-center border-b-[3px] border-b-transparent text-neutral-500 pb-[13px] pt-4" href="#">
                  <p class="text-neutral-500 text-sm font-bold leading-normal tracking-[0.015em]">Select Model</p>
                </a>
              </div>
            </div>
            <div id="upload-section" class="flex flex-col p-4">
              <div class="flex flex-col items-center gap-6 rounded-lg border-2 border-dashed border-[#dbdbdb] px-6 py-14">
                <div class="flex max-w-[480px] flex-col items-center gap-2">
                  <p class="text-[#141414] text-lg font-bold leading-tight tracking-[-0.015em] max-w-[480px] text-center">Drag and drop a photo here, or browse</p>
                  <p class="text-[#141414] text-sm font-normal leading-normal max-w-[480px] text-center">Supported formats: JPG, PNG</p>
                </div>
                <input type="file" id="profile-pic" class="hidden">
                <label for="profile-pic"
                  class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-4 bg-[#ededed] text-[#141414] text-sm font-bold leading-normal tracking-[0.015em]"
                >
                  <span class="truncate">Browse Files</span>
                </label>
              </div>
                <div id="image-preview-container" class="mt-3" style="display: none;">
                    <img id="image-preview" class="img-fluid" alt="Image Preview">
                    <button type="button" class="btn-close" id="remove-image-btn" aria-label="Close"></button>
                </div>
            </div>
            <div id="model-section" class="hidden p-4">
                <input type="hidden" id="selected-model" name="selected-model" value="">
                <div class="grid grid-cols-4 gap-4">
                    <img src="https://storage.googleapis.com/ksaw_thelook_ecommerce/static/model_1.jpg" class="img-fluid model-pic model-selection" data-model-id="1" alt="Model 1">
                    <img src="https://storage.googleapis.com/ksaw_thelook_ecommerce/static/model_2.jpg" class="img-fluid model-pic model-selection" data-model-id="2" alt="Model 2">
                    <img src="https://storage.googleapis.com/ksaw_thelook_ecommerce/static/model_3.jpg" class="img-fluid model-pic model-selection" data-model-id="3" alt="Model 3">
                    <img src="https://storage.googleapis.com/ksaw_thelook_ecommerce/static/model_4.jpg" class="img-fluid model-pic model-selection" data-model-id="4" alt="Model 4">
                </div>
            </div>
            <div class="flex px-4 py-3 justify-end">
              <button id="proceed-btn"
                class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-4 bg-[#141414] text-neutral-50 text-sm font-bold leading-normal tracking-[0.015em]"
              >
                <span class="truncate">Try On!</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Loading Modal -->
    <div id="loadingModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden">
        <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
            <div class="mt-3 text-center">
                <h3 class="text-lg leading-6 font-medium text-gray-900">Assigning you a changing room!</h3>
                <div class="mt-2 px-7 py-3">
                    <div class="animate-spin inline-block w-8 h-8 border-4 rounded-full border-t-transparent" role="status">
                    </div>
                    <p class="text-sm text-gray-500 mt-2">Prepping your runway moment.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Results Container -->
    <div class="flex justify-center">
        <div class="container mt-5" id="results-container" {% if not vto_image_url %}style="display: none;"{% endif %}>
            <h2 class="mb-4 text-center">Your Virtual Try-On</h2>
            <div class="row justify-content-center">
                <div class="flex justify-center" id="results-image-container">
                    {% if vto_image_url %}
                    <div class="flex flex-col items-center">
                        <img src="{{ vto_image_url }}" class="img-fluid w-1/2" alt="Virtual Try-On Result">
                        <h3 class="text-lg font-bold mt-4">Like what you see?</h3>
                        <a href="/add_to_cart" class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-4 bg-[#141414] text-neutral-50 text-sm font-bold leading-normal tracking-[0.015em] mt-2">
                            <span class="truncate">Add To Cart</span>
                        </a>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    <script src="{{ url_for('static', filename='js/virtual_try_on.js') }}"></script>
{% endblock %}